/*  * itunes-notify.c * * Purpose: Sends a distributed iTunes status notification on Mac OS X. * Author: Ken McLeod ( thecloud at mac.com ) * Last modified: 2011-08-18 * License: BSD * * This program is useful if your music player is something other than iTunes, * but you still want iTunes-aware apps to display your current music status. * It was primarily designed to use with the command-line music player 'cmus' * as its status display program ("set status_display_program=itunes-notify"). * More information on 'cmus' is available at <http://cmus.sourceforge.net/>. * * To build this program (on Mac OS X): * cc itunes-notify.c -framework CoreFoundation -o itunes-notify * * Example usage: * itunes-notify state "playing" artist "David Bowie" title "Golden Years" album "Station To Station" * */#include <stdio.h>#include <CoreFoundation/CoreFoundation.h>void post_distributed_notification(char *state, char *artist, char *album, char *title, char *url){    CFNotificationCenterRef center = CFNotificationCenterGetDistributedCenter();    CFMutableDictionaryRef info = CFDictionaryCreateMutable(NULL, 0,        &kCFTypeDictionaryKeyCallBacks, &kCFTypeDictionaryValueCallBacks);    CFStringRef stateStr = (state) ? CFStringCreateWithCString(NULL, state, kCFStringEncodingUTF8) : NULL;    CFStringRef artistStr = (artist) ? CFStringCreateWithCString(NULL, artist, kCFStringEncodingUTF8) : NULL;    CFStringRef albumStr = (album) ? CFStringCreateWithCString(NULL, album, kCFStringEncodingUTF8) : NULL;    CFStringRef titleStr = (title) ? CFStringCreateWithCString(NULL, title, kCFStringEncodingUTF8) : NULL;    CFStringRef urlStr = (url) ? CFStringCreateWithCString(NULL, url, kCFStringEncodingUTF8) : NULL;    if (stateStr) { CFDictionaryAddValue(info, CFSTR("Player State"), stateStr); CFRelease(stateStr); }    if (artistStr) { CFDictionaryAddValue(info, CFSTR("Artist"), artistStr); CFRelease(artistStr); }    if (albumStr) { CFDictionaryAddValue(info, CFSTR("Album"), albumStr); CFRelease(albumStr); }    if (titleStr) { CFDictionaryAddValue(info, CFSTR("Name"), titleStr); CFRelease(titleStr); }    if (urlStr) { CFDictionaryAddValue(info, CFSTR("Location"), urlStr); CFRelease(urlStr); }    CFNotificationCenterPostNotification(center,        CFSTR("com.apple.iTunes.playerInfo"),   /* notification name */        CFSTR("com.apple.iTunes.player"),       /* observed object */        info,                                   /* info dictionary */        TRUE);                                  /* post immediately */    CFRelease(info);}void usage(const char *arg0){    fprintf(stdout, "Usage: %s key1 val1 key2 val2 ...\n", arg0);    fprintf(stdout, "Sends a distributed iTunes notification on Mac OS X.\n");    fprintf(stdout, "Keys: status file url artist album title\n");    fprintf(stdout, "Values must be UTF-8 encoded strings.\n");    fflush(stdout);}int main(int argc, const char * argv[]){    unsigned int i;    char *status="";    char *artist="";    char *album="";    char *title="";    char *url="";    char *filename="";    if(argc < 2 || !(argc % 2)) {        usage(argv[0]);        exit(1);    }    for(i=1; i<argc; i++) {        if(!strcmp(argv[i], "status")) {            status = (char*)argv[++i];        } else if(!strcmp(argv[i], "file")) {            filename = (char*)argv[++i];        } else if(!strcmp(argv[i], "url")) {            url = (char*)argv[++i];        } else if(!strcmp(argv[i], "artist")) {            artist = (char*)argv[++i];        } else if(!strcmp(argv[i], "album")) {            album = (char*)argv[++i];        } else if(!strcmp(argv[i], "title")) {            title = (char*)argv[++i];        } else {            ++i; /* ignore all others */        }    }    if(strlen(filename) > 0 && filename[0] == '/') {        url = "file://localhost";    }    if(!strcmp(status, "paused") || !strcmp(status, "stopped")) {        status = "Paused";    } else {        status = "Playing";    }    post_distributed_notification(status, artist, album, title, url);    return 0;}